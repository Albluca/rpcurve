---
title: "Using rpgraph to study principal circles"
author: "Luca Albergante (luca.albergante@gmail.com)"
date: "`r Sys.Date()`"
output:
  md_document:
    variant: markdown_github
---



## Example 1 - Circle

This section describes how to produce a circular principal graph.

```{r}
library(rpgraph)

Data <- simple_circle

Results <- computeElasticPrincipalGraph(Data = Data, NumNodes = 40, Method = 'CircleConfiguration')

```

Now `Results` contain the processed principal graph. Diagnostic information can be obtained using

```{r, fig.height=5, fig.width=5}
plotMSDEnergyPlot(Results, Main = "Pincipal Circle", Cex.Main = 1)
```

and

```{r, fig.height=5, fig.width=5}
accuracyComplexityPlot(Results, Main = "Pincipal Circle", Cex.Main = 1, Mode = 5)
```

It it also possible to zoom into a specific area of the accuracy/complexity plot by using the Xlims parameter.

```{r, fig.height=5, fig.width=5}
accuracyComplexityPlot(Results, Main = "Pincipal Circle", Cex.Main = 1, Xlims = c(.97, .98))
```

Data can be plotted in 2D using the R built-in functions

```{r, fig.height=5, fig.width=5}
plotData2D(Data = simple_circle, PrintGraph = Results,
           GroupsLab = rep(1, nrow(simple_circle)), Xlab = "Dimension 1", Ylab = "Dimension 2")
```

or plotly, which produces an interactive plot. Using plotly interactivelly requires running the code in RStudio (does it?)

```{r, fig.height=5, fig.width=5}
plotData2D(Data = simple_circle, PrintGraph = Results, Plot.ly = TRUE,
           GroupsLab = rep(1, nrow(simple_circle)), Xlab = "Dimension 1", Ylab = "Dimension 2")
```

This commands will produce a list of warnings. Unfortunately there is not an easy way to fix it ...

The plotly graph can be exported on the web, for example on [plot.ly](http://plot.ly) using the instruction provided [here](http://plot.ly/r/getting-started/).


Data can also be plotted in 3D using the functionalities provided by the `rgl` package


```{r, fig.height=5, fig.width=5, eval=FALSE}
plotData3D(Data = simple_circle, PrintGraph = Results, Plot.ly = FALSE,
           GroupsLab = rep(1, nrow(simple_circle)), NodeSizeMult = 0.05,
           Xlab = "Dimension 1", Ylab = "Dimension 2", Zlab = "Dimension 3")
```

The code is not executed in the html version of the vignette. This can be fixed (in priciple) at a later stage of development.

For `rgl` to work correctly on MacOS, a proper X11 environment need to be installed. The most common solution is the installation of [XQuartz](http://www.xquartz.org/). If the code crashes R, try using

```{r, eval=FALSE}
library("rgl")
open3d()
```

before invoking the `plotData3D` function.

It is also possible to produce 3D plots using plot.ly.

```{r, fig.height=5, fig.width=5}
plotData3D(Data = simple_circle, PrintGraph = Results, Plot.ly = TRUE,
           GroupsLab = rep(1, nrow(simple_circle)),
           Xlab = "Dimension 1", Ylab = "Dimension 2", Zlab = "Dimension 3")
```

Similarly to 2D, it is possible to export the plot to a web resource.

To see how different populations distribute among the nodes of the graph by providing a population identifier to each point in the original data (The `Categories` vector). In the following example, three populations are randomly assigned.

```{r, fig.height=7, fig.width=7}
Net <- ConstructGraph(Results = Results, DirectionMat = NULL, Thr = 0.05)
TaxonList <- getTaxonMap(Results = Results, Data = Data)

InfoData <- plotPieNet(Results = Results, Data = simple_circle, NodeSizeMult = 4,
                       Categories = sample(1:3, nrow(simple_circle), replace = TRUE),
           Graph = Net, TaxonList = TaxonList, LayOut = 'circle', Main = "Pincipal Circle")
```


## Example 2 - Curve

```{r}
Data <- simple_circle

Results <- computeElasticPrincipalGraph(Data = Data, NumNodes = 20, Method = 'CurveConfiguration')

```

```{r, fig.height=5, fig.width=5}
plotData2D(Data = simple_circle, PrintGraph = Results,
           GroupsLab = rep(1, nrow(simple_circle)), Xlab = "Dimension 1", Ylab = "Dimension 2")
```


## Example 3 - tree

```{r}
Data <- simple_tree

Results <- computeElasticPrincipalGraph(Data = Data, NumNodes = 40, Method = 'DefaultPrincipalTreeConfiguration')

```

```{r, fig.height=5, fig.width=5}
plotData2D(Data = simple_tree, PrintGraph = Results,
           GroupsLab = rep(1, nrow(simple_circle)), Xlab = "Dimension 1", Ylab = "Dimension 2")
```

## References
